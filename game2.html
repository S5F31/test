<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è©¦ç®¡æ¶²é«”è‡ªç”±åˆ†é¡éŠæˆ²</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e);
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
            padding: 25px;
            background: rgba(20, 20, 35, 0.8);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(100, 100, 150, 0.2);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            font-size: 3.2rem;
            margin-bottom: 15px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 25px rgba(255, 107, 107, 0.4);
            letter-spacing: 2px;
        }
        
        .subtitle {
            color: #b0b0d0;
            font-size: 1.3rem;
            margin-bottom: 15px;
            max-width: 800px;
            line-height: 1.6;
            margin: 0 auto 20px;
        }
        
        .game-stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            margin-bottom: 35px;
            background: rgba(25, 25, 45, 0.9);
            padding: 25px 35px;
            border-radius: 18px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 100, 150, 0.2);
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
            padding: 0 15px;
            position: relative;
        }
        
        .stat-item:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 20%;
            height: 60%;
            width: 1px;
            background: rgba(100, 100, 150, 0.3);
        }
        
        .stat-value {
            font-size: 3.2rem;
            font-weight: bold;
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 15px currentColor;
        }
        
        .moves-value {
            color: #4ecdc4;
        }
        
        .level-value {
            color: #feca57;
        }
        
        .time-value {
            color: #ff6b6b;
        }
        
        .stat-label {
            color: #a0a0c0;
            font-size: 1.2rem;
            letter-spacing: 1px;
        }
        
        .game-board {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            margin-bottom: 40px;
        }
        
        .tubes-row {
            display: flex;
            justify-content: center;
            gap: 35px;
            flex-wrap: wrap;
            margin-bottom: 40px;
            padding: 25px;
            background: rgba(20, 20, 35, 0.7);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 100, 150, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .tube-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tube {
            width: 100px;
            height: 280px;
            background: rgba(30, 30, 50, 0.9);
            border-radius: 10px 10px 50px 50px;
            position: relative;
            overflow: hidden;
            border: 4px solid rgba(100, 100, 150, 0.6);
            box-shadow: 
                inset 0 0 25px rgba(0, 0, 0, 0.6),
                0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .tube::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: rgba(40, 40, 60, 0.8);
            border-radius: 6px 6px 0 0;
            z-index: 2;
        }
        
        .liquid {
            position: absolute;
            bottom: 0;
            left: 5px;
            right: 5px;
            border-radius: 20px 20px 0 0;
            transition: height 0.5s ease;
            z-index: 1;
        }
        
        .liquid::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px 20px 0 0;
        }
        
        .tube-label {
            margin-top: 15px;
            color: #b0b0d0;
            font-size: 1.3rem;
            font-weight: bold;
            padding: 8px 20px;
            background: rgba(40, 40, 60, 0.8);
            border-radius: 10px;
            min-width: 100px;
            text-align: center;
            letter-spacing: 1px;
        }
        
        .tube-container.selected .tube {
            transform: translateY(-15px);
            border-color: #feca57;
            box-shadow: 
                inset 0 0 25px rgba(0, 0, 0, 0.6),
                0 0 30px rgba(254, 202, 87, 0.7);
        }
        
        .tube-container.selected .tube-label {
            color: #feca57;
            background: rgba(60, 50, 30, 0.8);
        }
        
        .tube-container:hover:not(.selected) .tube {
            transform: translateY(-8px);
            border-color: rgba(200, 200, 255, 0.8);
        }
        
        .tube-container.empty .tube-label {
            color: #888;
        }
        
        .tube-container.completed .tube {
            border-color: #4ecdc4;
            box-shadow: 
                inset 0 0 25px rgba(0, 0, 0, 0.6),
                0 0 25px rgba(78, 205, 196, 0.5);
        }
        
        .tube-container.completed .tube-label {
            color: #4ecdc4;
        }
        
        .liquid-count {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 0.8rem;
            padding: 2px 5px;
            border-radius: 3px;
            z-index: 3;
        }
        
        .game-controls {
            display: flex;
            gap: 25px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .game-btn {
            padding: 18px 40px;
            font-size: 1.3rem;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            letter-spacing: 1px;
            min-width: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .start-btn {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }
        
        .reset-btn {
            background: linear-gradient(135deg, #ff6b6b, #c44d58);
            color: white;
        }
        
        .hint-btn {
            background: linear-gradient(135deg, #feca57, #ff9f43);
            color: white;
        }
        
        .undo-btn {
            background: linear-gradient(135deg, #45b7d1, #3498db);
            color: white;
        }
        
        .solve-btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
        }
        
        .game-btn:hover {
            transform: translateY(-7px);
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.4);
        }
        
        .game-btn:active {
            transform: translateY(-2px);
        }
        
        .game-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .game-info {
            display: flex;
            width: 100%;
            max-width: 900px;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .instructions {
            flex: 1;
            background: rgba(25, 25, 45, 0.9);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 100, 150, 0.2);
        }
        
        .instructions h2 {
            color: #feca57;
            margin-bottom: 25px;
            font-size: 1.9rem;
            text-align: center;
        }
        
        .instructions-list {
            list-style-type: none;
        }
        
        .instructions-list li {
            margin-bottom: 18px;
            padding-left: 35px;
            position: relative;
            color: #d0d0e0;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        
        .instructions-list li::before {
            content: "â—";
            color: #4ecdc4;
            font-size: 1.2rem;
            position: absolute;
            left: 0;
            top: 2px;
        }
        
        .hint-box {
            flex: 1;
            background: rgba(25, 25, 45, 0.9);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 100, 150, 0.2);
            display: none;
        }
        
        .hint-box.active {
            display: block;
        }
        
        .hint-box h3 {
            color: #feca57;
            margin-bottom: 20px;
            font-size: 1.7rem;
            text-align: center;
        }
        
        .hint-text {
            color: #d0d0e0;
            font-size: 1.2rem;
            line-height: 1.6;
            text-align: center;
            padding: 15px;
            background: rgba(40, 40, 60, 0.6);
            border-radius: 10px;
            border-left: 4px solid #feca57;
        }
        
        .message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .message-box {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 60px;
            border-radius: 25px;
            text-align: center;
            max-width: 700px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(100, 100, 150, 0.3);
            animation: messageAppear 0.5s ease-out;
        }
        
        @keyframes messageAppear {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .message-title {
            font-size: 3.5rem;
            margin-bottom: 25px;
            color: #feca57;
            text-shadow: 0 0 20px rgba(254, 202, 87, 0.7);
        }
        
        .message-content {
            font-size: 1.6rem;
            margin-bottom: 40px;
            color: #d0d0e0;
            line-height: 1.6;
        }
        
        .message-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 50px;
            background: rgba(30, 30, 50, 0.7);
            padding: 25px;
            border-radius: 15px;
        }
        
        .message-stat {
            text-align: center;
        }
        
        .message-stat-value {
            font-size: 2.8rem;
            font-weight: bold;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }
        
        .moves-stat {
            color: #4ecdc4;
        }
        
        .time-stat {
            color: #ff6b6b;
        }
        
        .score-stat {
            color: #feca57;
        }
        
        .message-stat-label {
            color: #a0a0c0;
            font-size: 1.2rem;
        }
        
        .close-btn {
            background: linear-gradient(135deg, #ff6b6b, #c44d58);
            color: white;
            padding: 18px 50px;
            font-size: 1.4rem;
            border-radius: 15px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
            transition: all 0.3s;
        }
        
        .close-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(255, 107, 107, 0.4);
        }
        
        .liquid-animation {
            animation: liquidMove 1.5s ease-out;
        }
        
        @keyframes liquidMove {
            0% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0); }
        }
        
        .tube-shake {
            animation: shakeTube 0.5s ease-in-out;
        }
        
        @keyframes shakeTube {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .completed-pulse {
            animation: completedPulse 2s infinite;
        }
        
        @keyframes completedPulse {
            0% { box-shadow: 0 0 15px rgba(78, 205, 196, 0.5); }
            50% { box-shadow: 0 0 30px rgba(78, 205, 196, 0.8); }
            100% { box-shadow: 0 0 15px rgba(78, 205, 196, 0.5); }
        }
        
        .color-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
            border: 2px solid white;
        }
        
        footer {
            margin-top: 40px;
            color: #666;
            text-align: center;
            font-size: 1rem;
            padding: 25px;
            width: 100%;
            border-top: 1px solid rgba(100, 100, 150, 0.2);
        }
        
        @media (max-width: 1100px) {
            .tubes-row {
                gap: 25px;
            }
            
            .tube {
                width: 90px;
                height: 250px;
            }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2.4rem;
            }
            
            .game-stats {
                flex-direction: column;
                gap: 25px;
                padding: 20px;
            }
            
            .stat-item:not(:last-child)::after {
                display: none;
            }
            
            .tubes-row {
                gap: 20px;
            }
            
            .tube {
                width: 80px;
                height: 220px;
            }
            
            .game-info {
                flex-direction: column;
            }
            
            .game-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .game-btn {
                width: 90%;
                max-width: 300px;
            }
            
            .message-box {
                padding: 40px 20px;
            }
            
            .message-title {
                font-size: 2.5rem;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 2rem;
            }
            
            .tube {
                width: 70px;
                height: 200px;
            }
            
            .tube-label {
                font-size: 1.1rem;
                min-width: 80px;
                padding: 6px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§ª è©¦ç®¡æ¶²é«”è‡ªç”±åˆ†é¡</h1>
            <p class="subtitle">å°‡æ‰€æœ‰è©¦ç®¡è£¡çš„æ¶²é«”æŒ‰ç…§é¡è‰²åˆ†é–‹ï¼Œæ¯å€‹è©¦ç®¡è£¡åªç•™åŒä¸€ç¨®é¡è‰²çš„æ°´ã€‚å¯ä»¥å°‡æ¶²é«”å€’å…¥ä»»ä½•è©¦ç®¡ï¼Œåªè¦ä¸è¶…éå®¹é‡é™åˆ¶ã€‚</p>
        </header>
        
        <div class="game-stats">
            <div class="stat-item">
                <div class="stat-value moves-value" id="moves">0</div>
                <div class="stat-label">ç§»å‹•æ¬¡æ•¸</div>
            </div>
            <div class="stat-item">
                <div class="stat-value level-value" id="level">1</div>
                <div class="stat-label">é—œå¡</div>
            </div>
            <div class="stat-item">
                <div class="stat-value time-value" id="time">0</div>
                <div class="stat-label">æ™‚é–“ (ç§’)</div>
            </div>
        </div>
        
        <div class="game-board">
            <div class="tubes-row" id="tubes-container">
                <!-- è©¦ç®¡æœƒç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="game-controls">
            <button class="game-btn start-btn" id="start-btn">
                <span>â–¶</span> é–‹å§‹éŠæˆ²
            </button>
            <button class="game-btn hint-btn" id="hint-btn">
                <span>ğŸ’¡</span> æç¤º
            </button>
            <button class="game-btn undo-btn" id="undo-btn" disabled>
                <span>â†¶</span> æ’¤æ¶ˆ
            </button>
            <button class="game-btn solve-btn" id="solve-btn">
                <span>âš¡</span> è‡ªå‹•è§£é¡Œ
            </button>
            <button class="game-btn reset-btn" id="reset-btn">
                <span>ğŸ”„</span> é‡æ–°é–‹å§‹
            </button>
        </div>
        
        <div class="game-info">
            <div class="instructions">
                <h2>éŠæˆ²è¦å‰‡ï¼ˆè‡ªç”±ç‰ˆï¼‰</h2>
                <ul class="instructions-list">
                    <li><span class="color-indicator" style="background-color: #ff6b6b;"></span>ç›®æ¨™ï¼šå°‡æ‰€æœ‰è©¦ç®¡è£¡çš„æ¶²é«”æŒ‰ç…§é¡è‰²åˆ†é–‹ï¼Œæ¯å€‹è©¦ç®¡è£¡åªç•™åŒä¸€ç¨®é¡è‰²çš„æ°´</li>
                    <li><span class="color-indicator" style="background-color: #4ecdc4;"></span>æ“ä½œï¼šé»æ“Šä¸€å€‹è£æœ‰æ¶²é«”çš„è©¦ç®¡ï¼Œå†é»æ“Šå¦ä¸€å€‹ç›®æ¨™è©¦ç®¡ï¼Œå³å¯å°‡æœ€ä¸Šæ–¹çš„æ¶²é«”å€’å…¥ç›®æ¨™è©¦ç®¡</li>
                    <li><span class="color-indicator" style="background-color: #45b7d1;"></span>é‡è¦ï¼šå¯ä»¥å°‡æ¶²é«”å€’å…¥ä»»ä½•è©¦ç®¡ï¼Œä¸é™åˆ¶é¡è‰²ï¼å¯ä»¥å€’å…¥ä¸åŒé¡è‰²ä¸Šæ–¹</li>
                    <li><span class="color-indicator" style="background-color: #96ceb4;"></span>å®¹é‡ï¼šæ¯æ”¯è©¦ç®¡æœ€å¤šå®¹ç´4å€‹å–®ä½çš„æ¶²é«”ï¼Œè¶…éç„¡æ³•å€’å…¥</li>
                    <li><span class="color-indicator" style="background-color: #feca57;"></span>èµ·å§‹ï¼šéŠæˆ²é–‹å§‹æ™‚æœ‰5æ”¯è©¦ç®¡ï¼Œå…¶ä¸­1æ”¯ç‚ºç©ºç®¡ï¼Œæ–¹ä¾¿éæ¸¡</li>
                    <li><span class="color-indicator" style="background-color: #a29bfe;"></span>å‹åˆ©ï¼šç•¶æ‰€æœ‰è©¦ç®¡éƒ½åªåŒ…å«ä¸€ç¨®é¡è‰²æˆ–ç‚ºç©ºæ™‚ï¼ŒéŠæˆ²å‹åˆ©</li>
                </ul>
            </div>
            
            <div class="hint-box" id="hint-box">
                <h3>éŠæˆ²æç¤º</h3>
                <div class="hint-text" id="hint-text">
                    é»æ“Šã€Œæç¤ºã€æŒ‰éˆ•ç²å–å¹«åŠ©
                </div>
            </div>
        </div>
        
        <footer>
            <p>è©¦ç®¡æ¶²é«”è‡ªç”±åˆ†é¡éŠæˆ² | HTML5 + JavaScript å¯¦ç¾ | å¯ä»¥è‡ªç”±å€’å…¥ä»»ä½•è©¦ç®¡ï¼</p>
        </footer>
        
        <div class="message-overlay" id="message-overlay">
            <div class="message-box">
                <div class="message-title" id="message-title">æ­å–œï¼</div>
                <div class="message-content" id="message-content">ä½ æˆåŠŸå®Œæˆäº†ç¬¬1é—œï¼</div>
                
                <div class="message-stats">
                    <div class="message-stat">
                        <div class="message-stat-value moves-stat" id="message-moves">0</div>
                        <div class="message-stat-label">ç§»å‹•æ¬¡æ•¸</div>
                    </div>
                    <div class="message-stat">
                        <div class="message-stat-value time-stat" id="message-time">0</div>
                        <div class="message-stat-label">ç”¨æ™‚ (ç§’)</div>
                    </div>
                    <div class="message-stat">
                        <div class="message-stat-value score-stat" id="message-score">0</div>
                        <div class="message-stat-label">åˆ†æ•¸</div>
                    </div>
                </div>
                
                <button class="close-btn" id="close-btn">ç¹¼çºŒä¸‹ä¸€é—œ</button>
            </div>
        </div>
    </div>

    <script>
        // éŠæˆ²é…ç½®
        const CONFIG = {
            totalTubes: 5,           // ç¸½è©¦ç®¡æ•¸
            maxLiquidPerTube: 4,     // æ¯æ”¯è©¦ç®¡æœ€å¤§å®¹é‡
            emptyTubes: 1,           // ç©ºè©¦ç®¡æ•¸é‡
            colors: [                // é¡è‰²å®šç¾©
                { name: "ç´…è‰²", value: "#ff6b6b", lightValue: "#ff8e8e" },
                { name: "è—è‰²", value: "#45b7d1", lightValue: "#6acae8" },
                { name: "ç¶ è‰²", value: "#96ceb4", lightValue: "#b0e6cc" },
                { name: "é»ƒè‰²", value: "#feca57", lightValue: "#ffd985" },
                { name: "ç´«è‰²", value: "#a29bfe", lightValue: "#b9b4ff" }
            ]
        };
        
        // éŠæˆ²ç‹€æ…‹
        const gameState = {
            level: 1,
            moves: 0,
            time: 0,
            isPlaying: false,
            timer: null,
            selectedTube: null,
            tubes: [],
            history: [],
            colorsPerLevel: 4,  // ç¬¬ä¸€é—œä½¿ç”¨4ç¨®é¡è‰²
            maxLevel: 10
        };
        
        // DOM å…ƒç´ 
        const elements = {
            moves: document.getElementById('moves'),
            level: document.getElementById('level'),
            time: document.getElementById('time'),
            startBtn: document.getElementById('start-btn'),
            hintBtn: document.getElementById('hint-btn'),
            undoBtn: document.getElementById('undo-btn'),
            solveBtn: document.getElementById('solve-btn'),
            resetBtn: document.getElementById('reset-btn'),
            tubesContainer: document.getElementById('tubes-container'),
            hintBox: document.getElementById('hint-box'),
            hintText: document.getElementById('hint-text'),
            messageOverlay: document.getElementById('message-overlay'),
            messageTitle: document.getElementById('message-title'),
            messageContent: document.getElementById('message-content'),
            messageMoves: document.getElementById('message-moves'),
            messageTime: document.getElementById('message-time'),
            messageScore: document.getElementById('message-score'),
            closeBtn: document.getElementById('close-btn')
        };
        
        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            gameState.moves = 0;
            gameState.time = 0;
            gameState.isPlaying = false;
            gameState.selectedTube = null;
            gameState.history = [];
            
            clearInterval(gameState.timer);
            
            updateDisplay();
            createTubes();
            
            elements.startBtn.innerHTML = '<span>â–¶</span> é–‹å§‹éŠæˆ²';
            elements.undoBtn.disabled = true;
            elements.hintBox.classList.remove('active');
            
            // é‡ç½®é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.tube-container').forEach(tube => {
                tube.classList.remove('selected');
            });
        }
        
        // å‰µå»ºè©¦ç®¡
        function createTubes() {
            elements.tubesContainer.innerHTML = '';
            gameState.tubes = [];
            
            // è¨ˆç®—æœ¬é—œä½¿ç”¨çš„é¡è‰²
            const colorsInLevel = CONFIG.colors.slice(0, gameState.colorsPerLevel);
            
            // å‰µå»ºè©¦ç®¡å®¹å™¨
            for (let i = 0; i < CONFIG.totalTubes; i++) {
                const tubeContainer = document.createElement('div');
                tubeContainer.className = 'tube-container';
                tubeContainer.dataset.index = i;
                
                const tube = document.createElement('div');
                tube.className = 'tube';
                tube.id = `tube-${i}`;
                
                const tubeLabel = document.createElement('div');
                tubeLabel.className = 'tube-label';
                tubeLabel.textContent = `è©¦ç®¡ ${i + 1}`;
                
                tubeContainer.appendChild(tube);
                tubeContainer.appendChild(tubeLabel);
                elements.tubesContainer.appendChild(tubeContainer);
                
                // åˆå§‹åŒ–è©¦ç®¡ç‹€æ…‹
                gameState.tubes[i] = {
                    liquids: [],
                    element: tube,
                    label: tubeLabel,
                    container: tubeContainer
                };
            }
            
            // åˆ†é…æ¶²é«”åˆ°è©¦ç®¡
            distributeLiquids(colorsInLevel);
            
            // è¨­ç½®é»æ“Šäº‹ä»¶
            document.querySelectorAll('.tube-container').forEach((container, index) => {
                container.addEventListener('click', () => handleTubeClick(index));
            });
        }
        
        // åˆ†é…æ¶²é«”
        function distributeLiquids(colors) {
            // å‰µå»ºæ‰€æœ‰æ¶²é«”å–®å…ƒ
            let allLiquids = [];
            colors.forEach(color => {
                // æ¯ç¨®é¡è‰²4å€‹å–®ä½
                for (let i = 0; i < CONFIG.maxLiquidPerTube; i++) {
                    allLiquids.push(color);
                }
            });
            
            // æ‰“äº‚é †åº
            allLiquids.sort(() => Math.random() - 0.5);
            
            // è¨ˆç®—æ¯ç®¡æ‡‰æœ‰æ¶²é«”æ•¸ï¼ˆæœ€å¾Œä¸€ç®¡ç‚ºç©ºï¼‰
            const tubesWithLiquid = CONFIG.totalTubes - CONFIG.emptyTubes;
            const liquidsPerTube = Math.floor(allLiquids.length / tubesWithLiquid);
            
            // åˆ†é…æ¶²é«”åˆ°å‰å¹¾ç®¡
            for (let i = 0; i < tubesWithLiquid; i++) {
                const tubeLiquids = allLiquids.slice(i * liquidsPerTube, (i + 1) * liquidsPerTube);
                gameState.tubes[i].liquids = tubeLiquids;
                renderTube(i);
            }
            
            // æœ€å¾Œä¸€ç®¡ç‚ºç©º
            gameState.tubes[CONFIG.totalTubes - 1].liquids = [];
            gameState.tubes[CONFIG.totalTubes - 1].container.classList.add('empty');
            renderTube(CONFIG.totalTubes - 1);
            
            // å¦‚æœæœ‰å‰©é¤˜æ¶²é«”ï¼Œéš¨æ©Ÿåˆ†é…åˆ°éç©ºè©¦ç®¡
            const remainingLiquids = allLiquids.slice(tubesWithLiquid * liquidsPerTube);
            remainingLiquids.forEach(liquid => {
                const randomTube = Math.floor(Math.random() * tubesWithLiquid);
                if (gameState.tubes[randomTube].liquids.length < CONFIG.maxLiquidPerTube) {
                    gameState.tubes[randomTube].liquids.push(liquid);
                    renderTube(randomTube);
                }
            });
        }
        
        // æ¸²æŸ“è©¦ç®¡
        function renderTube(tubeIndex) {
            const tube = gameState.tubes[tubeIndex];
            const tubeElement = tube.element;
            
            // æ¸…ç©ºè©¦ç®¡
            tubeElement.innerHTML = '';
            
            // æ›´æ–°æ¨™ç±¤
            if (tube.liquids.length === 0) {
                tube.container.classList.add('empty');
            } else {
                tube.container.classList.remove('empty');
            }
            
            // æª¢æŸ¥è©¦ç®¡æ˜¯å¦å®Œæˆï¼ˆåŒä¸€é¡è‰²ï¼‰
            if (tube.liquids.length > 0) {
                const firstColor = tube.liquids[0].value;
                const allSame = tube.liquids.every(liquid => liquid.value === firstColor);
                
                if (allSame && tube.liquids.length === CONFIG.maxLiquidPerTube) {
                    tube.container.classList.add('completed');
                    tube.container.classList.add('completed-pulse');
                } else {
                    tube.container.classList.remove('completed');
                    tube.container.classList.remove('completed-pulse');
                }
            }
            
            // å‰µå»ºæ¶²é«”å±¤
            const liquidHeight = 280 / CONFIG.maxLiquidPerTube;
            
            tube.liquids.forEach((liquid, index) => {
                const liquidElement = document.createElement('div');
                liquidElement.className = 'liquid';
                liquidElement.style.backgroundColor = liquid.value;
                liquidElement.style.height = `${liquidHeight}px`;
                liquidElement.style.bottom = `${index * liquidHeight}px`;
                liquidElement.title = liquid.name;
                
                // æ·»åŠ æ¶²é¢æ•ˆæœ
                const surface = document.createElement('div');
                surface.style.position = 'absolute';
                surface.style.top = '0';
                surface.style.left = '0';
                surface.style.right = '0';
                surface.style.height = '15px';
                surface.style.background = `linear-gradient(to bottom, ${liquid.lightValue}, transparent)`;
                surface.style.borderRadius = '20px 20px 0 0';
                
                liquidElement.appendChild(surface);
                tubeElement.appendChild(liquidElement);
            });
            
            // æ·»åŠ æ¶²é«”æ•¸é‡æŒ‡ç¤º
            if (tube.liquids.length > 0) {
                const countIndicator = document.createElement('div');
                countIndicator.className = 'liquid-count';
                countIndicator.textContent = `${tube.liquids.length}/${CONFIG.maxLiquidPerTube}`;
                tubeElement.appendChild(countIndicator);
            }
        }
        
        // è™•ç†è©¦ç®¡é»æ“Š
        function handleTubeClick(tubeIndex) {
            if (!gameState.isPlaying) return;
            
            const tube = gameState.tubes[tubeIndex];
            
            // å¦‚æœæ²’æœ‰é¸ä¸­çš„è©¦ç®¡
            if (gameState.selectedTube === null) {
                // ä¸èƒ½é¸æ“‡ç©ºè©¦ç®¡ä½œç‚ºä¾†æº
                if (tube.liquids.length === 0) {
                    showHint("è«‹é¸æ“‡æœ‰æ¶²é«”çš„è©¦ç®¡");
                    shakeTube(tubeIndex);
                    return;
                }
                
                gameState.selectedTube = tubeIndex;
                tube.container.classList.add('selected');
                showHint(`å·²é¸æ“‡è©¦ç®¡ ${tubeIndex + 1}ï¼Œè«‹é¸æ“‡ç›®æ¨™è©¦ç®¡`);
            }
            // å¦‚æœå·²ç¶“æœ‰é¸ä¸­çš„è©¦ç®¡ï¼Œå˜—è©¦ç§»å‹•æ¶²é«”
            else if (gameState.selectedTube !== tubeIndex) {
                moveLiquid(gameState.selectedTube, tubeIndex);
                
                // å–æ¶ˆé¸ä¸­ç‹€æ…‹
                gameState.tubes[gameState.selectedTube].container.classList.remove('selected');
                gameState.selectedTube = null;
            }
            // å¦‚æœé»æ“ŠåŒä¸€æ”¯è©¦ç®¡ï¼Œå–æ¶ˆé¸ä¸­
            else {
                tube.container.classList.remove('selected');
                gameState.selectedTube = null;
                showHint("é¸æ“‡å·²å–æ¶ˆ");
            }
        }
        
        // ç§»å‹•æ¶²é«”
        function moveLiquid(fromIndex, toIndex) {
            const fromTube = gameState.tubes[fromIndex];
            const toTube = gameState.tubes[toIndex];
            
            // æª¢æŸ¥ä¾†æºè©¦ç®¡æ˜¯å¦ç‚ºç©º
            if (fromTube.liquids.length === 0) {
                showHint("ä¾†æºè©¦ç®¡æ˜¯ç©ºçš„");
                shakeTube(fromIndex);
                return false;
            }
            
            // æª¢æŸ¥ç›®æ¨™è©¦ç®¡æ˜¯å¦å·²æ»¿
            if (toTube.liquids.length >= CONFIG.maxLiquidPerTube) {
                showHint("ç›®æ¨™è©¦ç®¡å·²æ»¿");
                shakeTube(toIndex);
                return false;
            }
            
            // ç²å–è¦ç§»å‹•çš„æ¶²é«”ï¼ˆæœ€ä¸Šå±¤ï¼‰
            const liquidToMove = fromTube.liquids[fromTube.liquids.length - 1];
            
            // è‡ªç”±ç‰ˆï¼šå¯ä»¥å€’å…¥ä»»ä½•è©¦ç®¡ï¼Œåªè¦ä¸è¶…éå®¹é‡ï¼
            // ä¸å†æª¢æŸ¥é¡è‰²æ˜¯å¦ç›¸åŒ
            
            // ä¿å­˜æ­·å²ç‹€æ…‹
            saveHistory();
            
            // åŸ·è¡Œç§»å‹•
            fromTube.liquids.pop();
            toTube.liquids.push(liquidToMove);
            
            // æ›´æ–°ç§»å‹•æ¬¡æ•¸
            gameState.moves++;
            
            // é‡æ–°æ¸²æŸ“å…©å€‹è©¦ç®¡
            renderTube(fromIndex);
            renderTube(toIndex);
            
            // æ·»åŠ å‹•ç•«æ•ˆæœ
            animateLiquidMove(fromIndex, toIndex);
            
            // æ›´æ–°é¡¯ç¤º
            updateDisplay();
            
            // å•Ÿç”¨æ’¤æ¶ˆæŒ‰éˆ•
            elements.undoBtn.disabled = false;
            
            // æª¢æŸ¥éŠæˆ²æ˜¯å¦å®Œæˆ
            if (checkWinCondition()) {
                endGame(true);
            }
            
            return true;
        }
        
        // å‹•ç•«æ•ˆæœï¼šæ¶²é«”ç§»å‹•
        function animateLiquidMove(fromIndex, toIndex) {
            const fromTube = gameState.tubes[fromIndex].container;
            const toTube = gameState.tubes[toIndex].container;
            
            fromTube.classList.add('liquid-animation');
            toTube.classList.add('liquid-animation');
            
            setTimeout(() => {
                fromTube.classList.remove('liquid-animation');
                toTube.classList.remove('liquid-animation');
            }, 1500);
        }
        
        // æŠ–å‹•è©¦ç®¡ï¼ˆéŒ¯èª¤æç¤ºï¼‰
        function shakeTube(tubeIndex) {
            const tube = gameState.tubes[tubeIndex].container;
            tube.classList.add('tube-shake');
            
            setTimeout(() => {
                tube.classList.remove('tube-shake');
            }, 500);
        }
        
        // ä¿å­˜æ­·å²ç‹€æ…‹
        function saveHistory() {
            // æ·±æ‹·è²ç•¶å‰ç‹€æ…‹
            const stateCopy = gameState.tubes.map(tube => ({
                liquids: [...tube.liquids.map(l => ({...l}))]
            }));
            
            gameState.history.push(stateCopy);
            
            // é™åˆ¶æ­·å²è¨˜éŒ„æ•¸é‡
            if (gameState.history.length > 20) {
                gameState.history.shift();
            }
        }
        
        // æ’¤æ¶ˆæ“ä½œ
        function undoMove() {
            if (gameState.history.length === 0) return;
            
            // æ¢å¾©ä¸Šä¸€å€‹ç‹€æ…‹
            const lastState = gameState.history.pop();
            
            gameState.tubes.forEach((tube, index) => {
                tube.liquids = lastState[index].liquids.map(l => ({...l}));
                renderTube(index);
            });
            
            // æ›´æ–°ç§»å‹•æ¬¡æ•¸
            gameState.moves = Math.max(0, gameState.moves - 1);
            
            // æ›´æ–°é¡¯ç¤º
            updateDisplay();
            
            // å¦‚æœæ²’æœ‰æ›´å¤šæ­·å²è¨˜éŒ„ï¼Œç¦ç”¨æ’¤æ¶ˆæŒ‰éˆ•
            elements.undoBtn.disabled = gameState.history.length === 0;
            
            // å–æ¶ˆé¸ä¸­ç‹€æ…‹
            if (gameState.selectedTube !== null) {
                gameState.tubes[gameState.selectedTube].container.classList.remove('selected');
                gameState.selectedTube = null;
            }
            
            showHint("å·²æ’¤æ¶ˆä¸Šä¸€æ­¥æ“ä½œ");
        }
        
        // æª¢æŸ¥å‹åˆ©æ¢ä»¶
        function checkWinCondition() {
            for (let i = 0; i < gameState.tubes.length; i++) {
                const tube = gameState.tubes[i];
                
                // å¦‚æœè©¦ç®¡ç‚ºç©ºï¼Œè·³é
                if (tube.liquids.length === 0) continue;
                
                // æª¢æŸ¥æ‰€æœ‰æ¶²é«”æ˜¯å¦ç›¸åŒ
                const firstColor = tube.liquids[0].value;
                const allSame = tube.liquids.every(liquid => liquid.value === firstColor);
                
                // æª¢æŸ¥è©¦ç®¡æ˜¯å¦å·²æ»¿
                const isFull = tube.liquids.length === CONFIG.maxLiquidPerTube;
                
                if (!allSame || !isFull) return false;
            }
            
            return true;
        }
        
        // é–‹å§‹éŠæˆ²
        function startGame() {
            if (gameState.isPlaying) return;
            
            gameState.isPlaying = true;
            gameState.time = 0;
            gameState.moves = 0;
            
            elements.startBtn.innerHTML = '<span>â¸</span> éŠæˆ²é€²è¡Œä¸­';
            elements.startBtn.disabled = true;
            
            // å•Ÿå‹•è¨ˆæ™‚å™¨
            gameState.timer = setInterval(() => {
                gameState.time++;
                updateDisplay();
            }, 1000);
            
            updateDisplay();
            showHint("éŠæˆ²é–‹å§‹ï¼å¯ä»¥è‡ªç”±å°‡æ¶²é«”å€’å…¥ä»»ä½•è©¦ç®¡ï¼");
        }
        
        // çµæŸéŠæˆ²
        function endGame(isWin) {
            gameState.isPlaying = false;
            clearInterval(gameState.timer);
            
            elements.startBtn.innerHTML = '<span>â–¶</span> é–‹å§‹éŠæˆ²';
            elements.startBtn.disabled = false;
            
            // è¨ˆç®—åˆ†æ•¸
            const score = calculateScore();
            
            if (isWin) {
                elements.messageTitle.textContent = "æ­å–œå‹åˆ©ï¼";
                elements.messageContent.textContent = `ä½ æˆåŠŸå®Œæˆäº†ç¬¬${gameState.level}é—œï¼`;
            } else {
                elements.messageTitle.textContent = "éŠæˆ²çµæŸ";
                elements.messageContent.textContent = "è«‹ç¹¼çºŒåŠªåŠ›ï¼";
            }
            
            elements.messageMoves.textContent = gameState.moves;
            elements.messageTime.textContent = gameState.time;
            elements.messageScore.textContent = score;
            
            elements.messageOverlay.style.display = 'flex';
        }
        
        // è¨ˆç®—åˆ†æ•¸
        function calculateScore() {
            const timeBonus = Math.max(0, 5000 - gameState.time * 10);
            const movesBonus = Math.max(0, 3000 - gameState.moves * 20);
            const levelBonus = gameState.level * 500;
            
            return timeBonus + movesBonus + levelBonus;
        }
        
        // ä¸‹ä¸€é—œ
        function nextLevel() {
            if (gameState.level < gameState.maxLevel) {
                gameState.level++;
                gameState.colorsPerLevel = Math.min(5, 3 + Math.floor(gameState.level / 2));
            }
            
            elements.messageOverlay.style.display = 'none';
            initGame();
        }
        
        // é¡¯ç¤ºæç¤º
        function showHint(text) {
            elements.hintText.textContent = text;
            elements.hintBox.classList.add('active');
            
            // 5ç§’å¾Œéš±è—æç¤º
            setTimeout(() => {
                elements.hintBox.classList.remove('active');
            }, 5000);
        }
        
        // æä¾›éŠæˆ²æç¤º
        function giveHint() {
            if (!gameState.isPlaying) {
                showHint("è«‹å…ˆé–‹å§‹éŠæˆ²");
                return;
            }
            
            // å°‹æ‰¾å¯èƒ½çš„ç§»å‹•
            const hint = findBestMove();
            
            if (hint) {
                const fromColor = gameState.tubes[hint.from].liquids.slice(-1)[0].name;
                const toColor = gameState.tubes[hint.to].liquids.length > 0 ? 
                    gameState.tubes[hint.to].liquids.slice(-1)[0].name : "ç©ºè©¦ç®¡";
                
                showHint(`æç¤ºï¼šå°‡è©¦ç®¡ ${hint.from + 1} çš„ ${fromColor} æ¶²é«”ç§»å‹•åˆ°è©¦ç®¡ ${hint.to + 1} (${toColor})`);
            } else {
                showHint("å˜—è©¦å°‡ç›¸åŒé¡è‰²çš„æ¶²é«”é›†ä¸­åœ¨ä¸€èµ·ï¼Œæˆ–ä½¿ç”¨ç©ºè©¦ç®¡é€²è¡Œæ•´ç†");
            }
        }
        
        // å°‹æ‰¾æœ€ä½³ç§»å‹•
        function findBestMove() {
            // ç­–ç•¥1ï¼šå„ªå…ˆå®Œæˆå·²æ¥è¿‘å®Œæˆçš„è©¦ç®¡
            for (let fromIndex = 0; fromIndex < gameState.tubes.length; fromIndex++) {
                const fromTube = gameState.tubes[fromIndex];
                if (fromTube.liquids.length === 0) continue;
                
                const topColor = fromTube.liquids[fromTube.liquids.length - 1];
                
                // å°‹æ‰¾ç›¸åŒé¡è‰²çš„è©¦ç®¡
                for (let toIndex = 0; toIndex < gameState.tubes.length; toIndex++) {
                    if (fromIndex === toIndex) continue;
                    
                    const toTube = gameState.tubes[toIndex];
                    if (toTube.liquids.length >= CONFIG.maxLiquidPerTube) continue;
                    
                    // å¦‚æœç›®æ¨™è©¦ç®¡æœ‰ç›¸åŒé¡è‰²ä¸”æœªæ»¿ï¼Œå„ªå…ˆç§»å‹•
                    if (toTube.liquids.length > 0) {
                        const targetTopColor = toTube.liquids[toTube.liquids.length - 1];
                        if (topColor.value === targetTopColor.value) {
                            return { from: fromIndex, to: toIndex };
                        }
                    }
                }
            }
            
            // ç­–ç•¥2ï¼šå¦‚æœæ²’æœ‰ç›¸åŒé¡è‰²ï¼Œå°‹æ‰¾ç©ºè©¦ç®¡
            for (let fromIndex = 0; fromIndex < gameState.tubes.length; fromIndex++) {
                const fromTube = gameState.tubes[fromIndex];
                if (fromTube.liquids.length === 0) continue;
                
                for (let toIndex = 0; toIndex < gameState.tubes.length; toIndex++) {
                    if (fromIndex === toIndex) continue;
                    
                    const toTube = gameState.tubes[toIndex];
                    if (toTube.liquids.length === 0) {
                        return { from: fromIndex, to: toIndex };
                    }
                }
            }
            
            // ç­–ç•¥3ï¼šéš¨ä¾¿æ‰¾ä¸€å€‹æœ‰æ•ˆç§»å‹•
            for (let fromIndex = 0; fromIndex < gameState.tubes.length; fromIndex++) {
                const fromTube = gameState.tubes[fromIndex];
                if (fromTube.liquids.length === 0) continue;
                
                for (let toIndex = 0; toIndex < gameState.tubes.length; toIndex++) {
                    if (fromIndex === toIndex) continue;
                    
                    const toTube = gameState.tubes[toIndex];
                    if (toTube.liquids.length < CONFIG.maxLiquidPerTube) {
                        return { from: fromIndex, to: toIndex };
                    }
                }
            }
            
            return null;
        }
        
        // è‡ªå‹•è§£é¡Œ
        function solvePuzzle() {
            if (!gameState.isPlaying) {
                showHint("è«‹å…ˆé–‹å§‹éŠæˆ²");
                return;
            }
            
            showHint("è‡ªå‹•è§£é¡Œä¸­... é€™å¯èƒ½éœ€è¦ä¸€äº›æ™‚é–“");
            
            // ç°¡å–®çš„è‡ªå‹•è§£é¡Œç®—æ³•
            setTimeout(() => {
                const move = findBestMove();
                if (move) {
                    // æ¨¡æ“¬é»æ“Šé¸ä¸­ä¾†æºè©¦ç®¡
                    gameState.selectedTube = move.from;
                    gameState.tubes[move.from].container.classList.add('selected');
                    
                    // ç¨å¾Œæ¨¡æ“¬é»æ“Šç›®æ¨™è©¦ç®¡
                    setTimeout(() => {
                        moveLiquid(move.from, move.to);
                        
                        // å–æ¶ˆé¸ä¸­ç‹€æ…‹
                        if (gameState.selectedTube !== null) {
                            gameState.tubes[gameState.selectedTube].container.classList.remove('selected');
                            gameState.selectedTube = null;
                        }
                        
                        showHint("è‡ªå‹•å®Œæˆäº†ä¸€æ­¥ç§»å‹•");
                    }, 500);
                } else {
                    showHint("ç„¡æ³•æ‰¾åˆ°æœ‰æ•ˆç§»å‹•");
                }
            }, 1000);
        }
        
        // æ›´æ–°é¡¯ç¤º
        function updateDisplay() {
            elements.moves.textContent = gameState.moves;
            elements.level.textContent = gameState.level;
            elements.time.textContent = gameState.time;
        }
        
        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            elements.startBtn.addEventListener('click', startGame);
            elements.resetBtn.addEventListener('click', initGame);
            elements.hintBtn.addEventListener('click', giveHint);
            elements.undoBtn.addEventListener('click', undoMove);
            elements.solveBtn.addEventListener('click', solvePuzzle);
            elements.closeBtn.addEventListener('click', nextLevel);
        }
        
        // åˆå§‹åŒ–éŠæˆ²
        window.addEventListener('DOMContentLoaded', () => {
            initGame();
            setupEventListeners();
        });
    </script>
</body>
</html>