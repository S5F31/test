<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ninjaé£›åˆ€å¤§æŒ‘æˆ°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            user-select: none;
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #gameContainer {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        #gameTitle {
            text-align: center;
            color: #00BFFF;
            font-size: 42px;
            text-shadow: 0 0 15px #00BFFF;
            letter-spacing: 3px;
            padding: 20px 0;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 10;
        }
        
        #header {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 15px 20px;
            position: absolute;
            top: 80px;
            left: 0;
            z-index: 10;
        }
        
        .gameInfo {
            background-color: rgba(0, 50, 100, 0.8);
            padding: 12px 24px;
            border-radius: 10px;
            border: 1px solid #00BFFF;
            text-align: center;
            min-width: 140px;
        }
        
        .gameInfo h3 {
            color: #FFD700;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .gameInfo p {
            font-size: 24px;
            font-weight: bold;
        }
        
        #speedInfo {
            position: absolute;
            top: 160px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 50, 100, 0.8);
            padding: 8px 20px;
            border-radius: 10px;
            border: 1px solid #00BFFF;
            text-align: center;
            z-index: 10;
            font-size: 18px;
            font-weight: bold;
        }
        
        #bossIndicator {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #FF0000, #FF4500, #FFD700);
            padding: 10px 30px;
            border-radius: 20px;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 0 10px #FF0000;
            z-index: 10;
            display: none;
            animation: bossGlow 2s infinite alternate;
        }
        
        @keyframes bossGlow {
            0% { box-shadow: 0 0 20px #FF0000; }
            100% { box-shadow: 0 0 40px #FFD700; }
        }
        
        /* è—è‰²è¼ªç›¤å®¹å™¨ */
        #wheelContainer {
            position: absolute;
            width: 400px;
            height: 400px;
            left: calc(50% - 200px);
            top: calc(50% - 200px);
            z-index: 5;
        }
        
        /* è—è‰²è¼ªç›¤æœ¬é«” */
        #wheel {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: 
                radial-gradient(circle at 30% 30%, 
                    #1E90FF 0%, 
                    #4169E1 25%,
                    #0000CD 50%,
                    #000080 75%,
                    #00004D 100%),
                repeating-radial-gradient(circle at 50% 50%, 
                    transparent 0px, 
                    transparent 12px, 
                    rgba(0, 191, 255, 0.15) 13px,
                    transparent 14px,
                    transparent 25px,
                    rgba(30, 144, 255, 0.2) 26px,
                    transparent 27px);
            box-shadow: 
                inset 0 0 80px rgba(0, 0, 0, 0.8),
                inset 0 0 40px rgba(0, 100, 200, 0.6),
                0 0 60px rgba(30, 144, 255, 0.9),
                0 0 30px rgba(30, 144, 255, 0.7),
                0 0 0 15px rgba(0, 100, 200, 0.95),
                0 0 0 20px rgba(0, 50, 150, 0.8),
                0 0 0 25px rgba(30, 144, 255, 0.3);
            transform-origin: center center;
            border: 5px solid #1E90FF;
        }
        
        .knife-on-wheel {
            position: absolute;
            width: 24px;
            height: 100px;
            background: linear-gradient(to right, #C0C0C0, #E0E0E0, #C0C0C0);
            border-radius: 3px 3px 12px 12px;
            transform-origin: center bottom;
            z-index: 6;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.7);
        }
        
        .knife-on-wheel::before {
            content: '';
            position: absolute;
            width: 35px;
            height: 25px;
            background-color: #8B0000;
            border-radius: 6px;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .knife-on-wheel::after {
            content: '';
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: #FFD700;
            border-radius: 50%;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .special-knife {
            background: linear-gradient(45deg, #FFD700, #FF8C00, #FF4500);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.9);
        }
        
        .spike-on-wheel {
            position: absolute;
            width: 15px;
            height: 50px;
            background: linear-gradient(to bottom, #696969, #A9A9A9);
            border-radius: 3px;
            transform-origin: center bottom;
            z-index: 6;
        }
        
        .spike-on-wheel::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 20px solid #A9A9A9;
            top: -20px;
            left: -2.5px;
        }
        
        .spike-on-wheel::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #FF0000;
            border-radius: 50%;
            top: -15px;
            left: 3.5px;
        }
        
        .apple-on-wheel {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle at 30% 30%, #FF0000, #8B0000);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            transform-origin: center center;
            z-index: 6;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.7);
        }
        
        .apple-on-wheel::before {
            content: '';
            position: absolute;
            width: 5px;
            height: 10px;
            background-color: #8B4513;
            border-radius: 2px;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .coin {
            position: absolute;
            width: 25px;
            height: 25px;
            background: radial-gradient(circle at 30% 30%, #FFD700, #B8860B);
            border-radius: 50%;
            z-index: 20;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            display: none;
            animation: coinSpin 2s linear infinite;
        }
        
        .coin::before {
            content: 'ğŸ’°';
            position: absolute;
            font-size: 16px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        @keyframes coinSpin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        
        #playerKnife {
            position: absolute;
            width: 24px;
            height: 100px;
            background: linear-gradient(to right, #FFD700, #FFF, #FFD700);
            border-radius: 3px 3px 12px 12px;
            left: 50%;
            bottom: 150px;
            transform: translateX(-50%);
            z-index: 10;
            box-shadow: 0 0 20px rgba(255, 215, 0, 1);
        }
        
        #playerKnife::before {
            content: '';
            position: absolute;
            width: 35px;
            height: 25px;
            background-color: #8B0000;
            border-radius: 6px;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        #playerKnife::after {
            content: '';
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: #FF4500;
            border-radius: 50%;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        #controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            position: absolute;
            bottom: 50px;
            left: 0;
            width: 100%;
            z-index: 10;
        }
        
        #throwButton {
            background: linear-gradient(to bottom, #00BFFF, #0066CC);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 24px;
            font-weight: bold;
            border-radius: 60px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 191, 255, 0.6);
            transition: all 0.2s;
            width: 300px;
        }
        
        #instructions {
            text-align: center;
            color: #AAA;
            font-size: 16px;
            max-width: 700px;
            line-height: 1.6;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #00BFFF;
        }
        
        .hit-indicator {
            position: absolute;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 8px solid #00BFFF;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 7;
            pointer-events: none;
            opacity: 0;
        }
        
        .coin-indicator {
            position: absolute;
            color: #FFD700;
            font-size: 24px;
            font-weight: bold;
            z-index: 21;
            pointer-events: none;
            opacity: 0;
            text-shadow: 0 0 10px #000;
        }
        
        .knife-counter {
            position: absolute;
            bottom: 300px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 50, 100, 0.8);
            padding: 12px 25px;
            border-radius: 25px;
            border: 3px solid #00BFFF;
            font-size: 22px;
            font-weight: bold;
            z-index: 5;
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.7);
        }
        
        #levelComplete, #gameOver {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            z-index: 100;
            width: 500px;
        }
        
        #levelComplete {
            border: 4px solid #FFD700;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.9);
        }
        
        #gameOver {
            border: 4px solid #FF4500;
            box-shadow: 0 0 50px rgba(255, 69, 0, 0.9);
        }
        
        #levelComplete h2 {
            color: #FFD700;
            font-size: 42px;
            margin-bottom: 25px;
            text-shadow: 0 0 10px #FFD700;
        }
        
        #gameOver h2 {
            color: #FF4500;
            font-size: 42px;
            margin-bottom: 25px;
            text-shadow: 0 0 10px #FF4500;
        }
        
        #levelComplete p, #gameOver p {
            font-size: 24px;
            margin-bottom: 20px;
        }
        
        #nextLevelButton, #restartButton {
            background: linear-gradient(to bottom, #FFD700, #FF8C00);
            color: #000;
            border: none;
            padding: 18px 35px;
            font-size: 22px;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 25px;
            width: 250px;
        }
        
        #restartButton {
            background: linear-gradient(to bottom, #FF4500, #8B0000);
            color: white;
        }
        
        .keyHint {
            display: inline-block;
            background-color: #333;
            padding: 6px 12px;
            border-radius: 6px;
            border: 2px solid #666;
            margin: 0 5px;
            font-weight: bold;
        }
        
        #shopPanel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.95);
            padding: 40px;
            border-radius: 20px;
            border: 4px solid #FFD700;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.9);
            display: none;
            z-index: 100;
            width: 600px;
        }
        
        #shopPanel h2 {
            color: #FFD700;
            font-size: 36px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .knife-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .knife-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .knife-preview {
            width: 40px;
            height: 120px;
            background: linear-gradient(to right, #C0C0C0, #E0E0E0, #C0C0C0);
            border-radius: 3px 3px 12px 12px;
        }
        
        .knife-name {
            font-size: 20px;
            font-weight: bold;
        }
        
        .knife-price {
            color: #FFD700;
            font-size: 18px;
            font-weight: bold;
        }
        
        .buy-button {
            background: linear-gradient(to bottom, #32CD32, #228B22);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .buy-button:disabled {
            background: linear-gradient(to bottom, #666, #444);
            cursor: not-allowed;
        }
        
        #closeShop {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }
        
        #shopButton {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(to bottom, #FFD700, #B8860B);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            z-index: 10;
        }
        
        @keyframes knifeThrow {
            0% { 
                bottom: 150px; 
                transform: translateX(-50%) rotate(0deg);
            }
            50% { 
                bottom: 300px; 
                transform: translateX(-50%) rotate(0deg);
            }
            100% { 
                bottom: 380px; 
                transform: translateX(-50%) rotate(0deg);
            }
        }
        
        @keyframes hitEffect {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
            70% { opacity: 0.7; transform: translate(-50%, -50%) scale(1.4); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.8); }
        }
        
        @keyframes pulse {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.15); }
            100% { transform: translateX(-50%) scale(1); }
        }
        
        @keyframes knifeAppear {
            0% { transform: scale(0); }
            70% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        @keyframes coinCollect {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-50px); }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <h1 id="gameTitle">Ninjaé£›åˆ€å¤§æŒ‘æˆ°</h1>
        
        <div id="header">
            <div class="gameInfo">
                <h3>é—œå¡</h3>
                <p id="levelDisplay">1</p>
            </div>
            <div class="gameInfo">
                <h3>åˆ†æ•¸</h3>
                <p id="scoreDisplay">0</p>
            </div>
            <div class="gameInfo">
                <h3>é‡‘å¹£</h3>
                <p id="coinDisplay">0</p>
            </div>
            <div class="gameInfo">
                <h3>é£›åˆ€æ•¸</h3>
                <p id="knivesDisplay">5/5</p>
            </div>
        </div>
        
        <div id="speedInfo">æ—‹è½‰é€Ÿåº¦: 1.0x</div>
        <div id="bossIndicator">Boss é—œå¡ï¼</div>
        
        <button id="shopButton">å•†åº— ğŸ’°</button>
        
        <div id="wheelContainer">
            <div id="wheel"></div>
        </div>
        
        <div id="playerKnife"></div>
        <div class="hit-indicator" id="hitIndicator"></div>
        <div class="knife-counter" id="knifeCounter">é£›åˆ€: 5/5</div>
        
        <div id="levelComplete">
            <h2>é—œå¡å®Œæˆï¼</h2>
            <p>ä½ æˆåŠŸå°‡æ‰€æœ‰é£›åˆ€æ’ä¸Šè¼ªç›¤ï¼</p>
            <p>ç²å¾—é‡‘å¹£: <span id="levelCoins">10</span></p>
            <p>ç²å¾—åˆ†æ•¸: <span id="levelScore">100</span></p>
            <button id="nextLevelButton">ä¸‹ä¸€é—œ</button>
        </div>
        
        <div id="gameOver">
            <h2>éŠæˆ²çµæŸï¼</h2>
            <p id="gameOverReason">ä½ ç¢°åˆ°äº†è¼ªç›¤ä¸Šçš„é£›åˆ€ï¼</p>
            <p>æœ€çµ‚åˆ†æ•¸: <span id="finalScore">0</span></p>
            <p>ç²å¾—é‡‘å¹£: <span id="finalCoins">0</span> (é‡‘å¹£å·²ä¿å­˜)</p>
            <button id="restartButton">é‡æ–°é–‹å§‹</button>
        </div>
        
        <div id="shopPanel">
            <button id="closeShop">âœ•</button>
            <h2>é£›åˆ€å•†åº—</h2>
            <div id="knifeShopItems">
                <!-- é£›åˆ€å•†å“æœƒé€šéJavaScriptå‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
        
        <div id="controls">
            <button id="throwButton">æŠ•æ“²é£›åˆ€ (ç©ºæ ¼éµ)</button>
            <div id="instructions">
                <p>éŠæˆ²è¦å‰‡: å°‡æ‰€æœ‰é£›åˆ€æ’åˆ°æ—‹è½‰çš„è—è‰²è¼ªç›¤ä¸Šï¼Œé¿å…ç¢°åˆ°å·²æ’ä¸Šçš„é£›åˆ€æˆ–å°–åˆºã€‚</p>
                <p>æ“ä½œ: æŒ‰ä¸‹ <span class="keyHint">ç©ºæ ¼éµ</span> æˆ– <span class="keyHint">é»æ“ŠæŒ‰éˆ•</span> æŠ•æ“²é£›åˆ€</p>
            </div>
        </div>
    </div>

    <script>
        // éŠæˆ²è®Šæ•¸
        let game = {
            level: 1,
            score: 0,
            coins: 0,
            knives: 5,
            maxKnives: 5,
            knivesThrown: 0,
            wheelRotation: 0,
            rotationSpeed: 1.0, // åˆå§‹é€Ÿåº¦1.0
            gameActive: true,
            knivesOnWheel: [],
            spikesOnWheel: [],
            applesOnWheel: [],
            ownedKnives: ['gold'],
            currentKnife: 'gold',
            isBossLevel: false
        };
        
        // å¾localStorageè¼‰å…¥ä¿å­˜çš„é‡‘å¹£
        function loadSavedCoins() {
            const savedCoins = localStorage.getItem('ninjaKnifeCoins');
            if (savedCoins) {
                game.coins = parseInt(savedCoins);
                console.log(`è¼‰å…¥ä¿å­˜çš„é‡‘å¹£: ${game.coins}`);
            }
        }
        
        // ä¿å­˜é‡‘å¹£åˆ°localStorage
        function saveCoins() {
            localStorage.setItem('ninjaKnifeCoins', game.coins);
            console.log(`ä¿å­˜é‡‘å¹£: ${game.coins}`);
        }
        
        // é£›åˆ€é¡å‹å®šç¾©
        const knifeTypes = {
            'gold': {
                name: 'é»ƒé‡‘é£›åˆ€',
                price: 0,
                color: 'linear-gradient(to right, #FFD700, #FFF, #FFD700)',
                owned: true,
                special: false
            },
            'silver': {
                name: 'ç™½éŠ€é£›åˆ€',
                price: 50,
                color: 'linear-gradient(to right, #C0C0C0, #E0E0E0, #C0C0C0)',
                owned: false,
                special: false
            },
            'dragon': {
                name: 'é¾ç´‹é£›åˆ€',
                price: 150,
                color: 'linear-gradient(45deg, #FF4500, #FF8C00, #FFD700)',
                owned: false,
                special: true
            },
            'ice': {
                name: 'å¯’å†°é£›åˆ€',
                price: 100,
                color: 'linear-gradient(to right, #00FFFF, #E0FFFF, #00FFFF)',
                owned: false,
                special: true
            },
            'shadow': {
                name: 'æš—å½±é£›åˆ€',
                price: 200,
                color: 'linear-gradient(to right, #4B0082, #8A2BE2, #4B0082)',
                owned: false,
                special: true
            }
        };
        
        // è¼ªç›¤åƒæ•¸
        const WHEEL_RADIUS = 180;
        const WHEEL_CONTAINER_SIZE = 400;
        const HIT_TOLERANCE = 12;
        const MIN_ANGLE_DISTANCE = 18;
        
        // DOMå…ƒç´ 
        const wheelContainer = document.getElementById('wheelContainer');
        const wheel = document.getElementById('wheel');
        const playerKnife = document.getElementById('playerKnife');
        const hitIndicator = document.getElementById('hitIndicator');
        const knifeCounter = document.getElementById('knifeCounter');
        const levelDisplay = document.getElementById('levelDisplay');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const coinDisplay = document.getElementById('coinDisplay');
        const knivesDisplay = document.getElementById('knivesDisplay');
        const throwButton = document.getElementById('throwButton');
        const levelCompleteScreen = document.getElementById('levelComplete');
        const gameOverScreen = document.getElementById('gameOver');
        const nextLevelButton = document.getElementById('nextLevelButton');
        const restartButton = document.getElementById('restartButton');
        const bossIndicator = document.getElementById('bossIndicator');
        const shopButton = document.getElementById('shopButton');
        const shopPanel = document.getElementById('shopPanel');
        const closeShop = document.getElementById('closeShop');
        const knifeShopItems = document.getElementById('knifeShopItems');
        const speedInfo = document.getElementById('speedInfo');
        
        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            game.level = 1;
            game.score = 0;
            // ä¿ç•™é‡‘å¹£ä¸é‡ç½®ï¼Œåªè¼‰å…¥å·²ä¿å­˜çš„
            loadSavedCoins();
            game.knives = 5;
            game.maxKnives = 5;
            game.knivesThrown = 0;
            game.wheelRotation = 0;
            game.rotationSpeed = 1.0; // é‡ç½®ç‚ºåŸºç¤é€Ÿåº¦1.0
            game.gameActive = true;
            game.knivesOnWheel = [];
            game.spikesOnWheel = [];
            game.applesOnWheel = [];
            game.currentKnife = 'gold';
            game.isBossLevel = false;
            
            // æ›´æ–°é¡¯ç¤º
            updateDisplays();
            updateKnifeCounter();
            updateSpeedDisplay();
            updatePlayerKnifeAppearance();
            
            // æ¸…é™¤æ‰€æœ‰ç‰©ä»¶
            document.querySelectorAll('.knife-on-wheel, .spike-on-wheel, .apple-on-wheel, .coin').forEach(el => el.remove());
            
            // éš±è—ç•«é¢
            levelCompleteScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            bossIndicator.style.display = 'none';
            shopPanel.style.display = 'none';
            
            // é‡ç½®ç©å®¶é£›åˆ€ä½ç½®
            playerKnife.style.bottom = '150px';
            playerKnife.style.transform = 'translateX(-50%)';
            playerKnife.style.display = 'block';
            
            // é‡ç½®è¼ªç›¤æ—‹è½‰
            wheel.style.transform = 'translate(-50%, -50%) rotate(0deg)';
            
            // è¨­ç½®é—œå¡
            setupLevel();
            
            // åˆå§‹åŒ–å•†åº—
            initShop();
            
            // é–‹å§‹éŠæˆ²å¾ªç’°
            requestAnimationFrame(gameLoop);
            
            console.log(`éŠæˆ²é–‹å§‹ï¼Œç•¶å‰é‡‘å¹£: ${game.coins}, é€Ÿåº¦: ${game.rotationSpeed}`);
        }
        
        // æ›´æ–°é€Ÿåº¦é¡¯ç¤º
        function updateSpeedDisplay() {
            speedInfo.textContent = `æ—‹è½‰é€Ÿåº¦: ${game.rotationSpeed.toFixed(1)}x`;
        }
        
        // åˆå§‹åŒ–å•†åº—
        function initShop() {
            knifeShopItems.innerHTML = '';
            
            Object.entries(knifeTypes).forEach(([id, knife]) => {
                if (id === 'gold') return;
                
                const item = document.createElement('div');
                item.className = 'knife-item';
                
                item.innerHTML = `
                    <div class="knife-info">
                        <div class="knife-preview" style="background: ${knife.color};"></div>
                        <div>
                            <div class="knife-name">${knife.name}</div>
                            <div class="knife-price">ğŸ’° ${knife.price} é‡‘å¹£</div>
                        </div>
                    </div>
                    <button class="buy-button" data-id="${id}" ${knife.owned || game.coins < knife.price ? 'disabled' : ''}>
                        ${knife.owned ? 'å·²æ“æœ‰' : 'è³¼è²·'}
                    </button>
                `;
                
                knifeShopItems.appendChild(item);
            });
            
            // æ·»åŠ è³¼è²·äº‹ä»¶ç›£è½å™¨
            document.querySelectorAll('.buy-button').forEach(button => {
                button.addEventListener('click', function() {
                    const knifeId = this.getAttribute('data-id');
                    buyKnife(knifeId);
                });
            });
        }
        
        // è³¼è²·é£›åˆ€
        function buyKnife(knifeId) {
            const knife = knifeTypes[knifeId];
            
            if (game.coins >= knife.price && !knife.owned) {
                game.coins -= knife.price;
                knife.owned = true;
                game.ownedKnives.push(knifeId);
                saveCoins(); // è³¼è²·å¾Œä¿å­˜é‡‘å¹£
                updateDisplays();
                initShop();
                
                showMessage(`æˆåŠŸè³¼è²· ${knife.name}ï¼`);
            }
        }
        
        // æ›´æ–°ç©å®¶é£›åˆ€å¤–è§€
        function updatePlayerKnifeAppearance() {
            const knife = knifeTypes[game.currentKnife];
            playerKnife.style.background = knife.color;
            
            if (knife.special) {
                playerKnife.classList.add('special-knife');
            } else {
                playerKnife.classList.remove('special-knife');
            }
        }
        
        // è¨­ç½®é—œå¡ - åªåœ¨é€²å…¥æ–°é—œå¡æ™‚å¢åŠ é€Ÿåº¦
        function setupLevel() {
            // æª¢æŸ¥æ˜¯å¦ç‚ºBossé—œå¡
            game.isBossLevel = (game.level % 5 === 0);
            
            if (game.isBossLevel) {
                bossIndicator.style.display = 'block';
                game.maxKnives = 15;
                // Bossé—œå¡é€Ÿåº¦ç¨å¿«ï¼Œä½†ä»åªæ¯”æ™®é€šé—œå¡å¿«ä¸€é»
                game.rotationSpeed = 1.0 + (Math.floor(game.level / 5) * 0.3);
            } else {
                bossIndicator.style.display = 'none';
                game.maxKnives = Math.min(5 + Math.floor(game.level / 2), 18);
                // æ™®é€šé—œå¡ï¼šæ¯é—œå¢åŠ 0.1é€Ÿåº¦
                game.rotationSpeed = 1.0 + ((game.level - 1) * 0.1);
            }
            
            game.knives = game.maxKnives;
            game.knivesThrown = 0;
            
            // æ¸…é™¤è¼ªç›¤ä¸Šçš„ç‰©ä»¶
            game.knivesOnWheel = [];
            game.spikesOnWheel = [];
            game.applesOnWheel = [];
            document.querySelectorAll('.knife-on-wheel, .spike-on-wheel, .apple-on-wheel').forEach(el => el.remove());
            
            // éš¨æ©Ÿæ”¾ç½®å°–åˆº
            const spikeCount = game.isBossLevel ? 6 : 2 + Math.floor(game.level / 3);
            const usedAngles = [];
            
            for (let i = 0; i < spikeCount && i < 12; i++) {
                let angle;
                let attempts = 0;
                do {
                    angle = Math.floor(Math.random() * 360);
                    attempts++;
                    if (attempts > 100) break;
                } while (isAngleTooClose(angle, usedAngles, MIN_ANGLE_DISTANCE * 1.5));
                
                if (attempts <= 100) {
                    addSpikeToWheel(angle);
                    usedAngles.push(angle);
                }
            }
            
            // éš¨æ©Ÿæ”¾ç½®è˜‹æœ
            if (!game.isBossLevel) {
                const appleCount = Math.min(3, Math.floor(game.level / 2));
                for (let i = 0; i < appleCount; i++) {
                    let angle;
                    let attempts = 0;
                    do {
                        angle = Math.floor(Math.random() * 360);
                        attempts++;
                        if (attempts > 100) break;
                    } while (isAngleTooClose(angle, usedAngles, MIN_ANGLE_DISTANCE * 1.5));
                    
                    if (attempts <= 100) {
                        addAppleToWheel(angle);
                        usedAngles.push(angle);
                    }
                }
            }
            
            // æ›´æ–°é¡¯ç¤º
            updateDisplays();
            updateKnifeCounter();
            updateSpeedDisplay();
            
            console.log(`é€²å…¥é—œå¡ ${game.level}, é€Ÿåº¦: ${game.rotationSpeed.toFixed(1)}x`);
        }
        
        // æª¢æŸ¥è§’åº¦æ˜¯å¦å¤ªæ¥è¿‘å·²ä½¿ç”¨çš„è§’åº¦
        function isAngleTooClose(angle, usedAngles, minDistance) {
            for (const usedAngle of usedAngles) {
                const angleDiff = Math.abs(angle - usedAngle);
                const normalizedDiff = Math.min(angleDiff, 360 - angleDiff);
                if (normalizedDiff < minDistance) {
                    return true;
                }
            }
            return false;
        }
        
        // å°‡å°–åˆºæ·»åŠ åˆ°è¼ªç›¤
        function addSpikeToWheel(angle) {
            const spike = document.createElement('div');
            spike.className = 'spike-on-wheel';
            
            const radian = (angle * Math.PI) / 180;
            const x = Math.cos(radian) * WHEEL_RADIUS;
            const y = Math.sin(radian) * WHEEL_RADIUS;
            
            const containerCenter = WHEEL_CONTAINER_SIZE / 2;
            spike.style.left = `${containerCenter + x}px`;
            spike.style.top = `${containerCenter + y}px`;
            
            wheelContainer.appendChild(spike);
            game.spikesOnWheel.push({
                element: spike, 
                angle: angle,
                x: x,
                y: y
            });
        }
        
        // å°‡è˜‹æœæ·»åŠ åˆ°è¼ªç›¤
        function addAppleToWheel(angle) {
            const apple = document.createElement('div');
            apple.className = 'apple-on-wheel';
            
            const radian = (angle * Math.PI) / 180;
            const x = Math.cos(radian) * (WHEEL_RADIUS - 20);
            const y = Math.sin(radian) * (WHEEL_RADIUS - 20);
            
            const containerCenter = WHEEL_CONTAINER_SIZE / 2;
            apple.style.left = `${containerCenter + x}px`;
            apple.style.top = `${containerCenter + y}px`;
            
            wheelContainer.appendChild(apple);
            game.applesOnWheel.push({
                element: apple, 
                angle: angle,
                x: x,
                y: y
            });
        }
        
        // é¡¯ç¤ºæ¶ˆæ¯
        function showMessage(text) {
            const message = document.createElement('div');
            message.textContent = text;
            message.style.cssText = `
                position: fixed;
                top: 30%;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0,0,0,0.8);
                color: #FFD700;
                padding: 15px 30px;
                border-radius: 10px;
                font-size: 20px;
                z-index: 1000;
                animation: fadeOut 2s forwards;
            `;
            
            document.getElementById('gameContainer').appendChild(message);
            
            setTimeout(() => {
                message.remove();
            }, 2000);
        }
        
        // æ›´æ–°é¡¯ç¤º
        function updateDisplays() {
            levelDisplay.textContent = game.level;
            scoreDisplay.textContent = game.score;
            coinDisplay.textContent = game.coins;
            knivesDisplay.textContent = `${game.knives}/${game.maxKnives}`;
        }
        
        // æ›´æ–°é£›åˆ€è¨ˆæ•¸å™¨
        function updateKnifeCounter() {
            knifeCounter.textContent = `é£›åˆ€: ${game.knives}/${game.maxKnives}`;
        }
        
        // æŠ•æ“²é£›åˆ€ - ä¿®æ­£ç‰ˆæœ¬ï¼šç›´æ¥å‘ä¸Šï¼Œä¸æœƒå‘å³å
        function throwKnife() {
            if (!game.gameActive || game.knives <= 0) return;
            
            game.knives--;
            game.knivesThrown++;
            updateKnifeCounter();
            
            // é£›åˆ€å‘ä¸Šé£›è¡Œå‹•ç•« - ä¿®æ­£ç‰ˆæœ¬ï¼šä¿æŒXä½ç½®ä¸è®Š
            playerKnife.style.animation = 'knifeThrow 0.3s forwards';
            
            // è¨ˆç®—é£›åˆ€æ“Šä¸­è¼ªç›¤æ™‚çš„è§’åº¦
            const hitAngle = (360 - game.wheelRotation % 360) % 360;
            
            setTimeout(() => {
                if (!game.gameActive) return;
                
                // æª¢æŸ¥æ˜¯å¦æ“Šä¸­å·²å­˜åœ¨çš„é£›åˆ€æˆ–å°–åˆº
                const hitResult = checkHit(hitAngle);
                
                if (hitResult.hit) {
                    gameOver(hitResult.reason);
                    playerKnife.style.animation = '';
                    playerKnife.style.display = 'none';
                    return;
                }
                
                // æª¢æŸ¥æ˜¯å¦æ“Šä¸­è˜‹æœ
                const appleHit = checkAppleHit(hitAngle);
                if (appleHit) {
                    collectApple(appleHit);
                }
                
                // æˆåŠŸæ“Šä¸­è¼ªç›¤
                addKnifeToWheel(hitAngle);
                playerKnife.style.animation = '';
                playerKnife.style.bottom = '150px';
                playerKnife.style.display = 'block';
                
                // é¡¯ç¤ºæ“Šä¸­æ•ˆæœ
                showHitEffect();
                
                // å¢åŠ åˆ†æ•¸
                game.score += game.isBossLevel ? 50 : 10 * game.level;
                
                // é‡è¦ï¼šç§»é™¤é—œå¡å…§éš¨æŠ•æ“²æ¬¡æ•¸å¢åŠ é€Ÿåº¦çš„é‚è¼¯
                // ç¾åœ¨åªåœ¨é€²å…¥æ–°é—œå¡æ™‚æ‰å¢åŠ é€Ÿåº¦
                
                // æª¢æŸ¥æ˜¯å¦å®Œæˆé—œå¡
                if (game.knivesThrown === game.maxKnives) {
                    setTimeout(() => {
                        levelComplete();
                    }, 500);
                }
                
                updateDisplays();
            }, 300);
        }
        
        // æª¢æŸ¥æ˜¯å¦æ“Šä¸­å·²å­˜åœ¨çš„é£›åˆ€æˆ–å°–åˆº
        function checkHit(hitAngle) {
            // æª¢æŸ¥é£›åˆ€
            for (const knife of game.knivesOnWheel) {
                const angleDiff = Math.abs(knife.angle - hitAngle);
                const normalizedDiff = Math.min(angleDiff, 360 - angleDiff);
                
                if (normalizedDiff < HIT_TOLERANCE) {
                    return {hit: true, reason: "ä½ ç¢°åˆ°äº†è¼ªç›¤ä¸Šçš„é£›åˆ€ï¼"};
                }
            }
            
            // æª¢æŸ¥å°–åˆº
            for (const spike of game.spikesOnWheel) {
                const angleDiff = Math.abs(spike.angle - hitAngle);
                const normalizedDiff = Math.min(angleDiff, 360 - angleDiff);
                
                if (normalizedDiff < HIT_TOLERANCE) {
                    return {hit: true, reason: "ä½ ç¢°åˆ°äº†å°–åˆºï¼"};
                }
            }
            
            return {hit: false, reason: ""};
        }
        
        // æª¢æŸ¥æ˜¯å¦æ“Šä¸­è˜‹æœ
        function checkAppleHit(hitAngle) {
            for (let i = 0; i < game.applesOnWheel.length; i++) {
                const apple = game.applesOnWheel[i];
                const angleDiff = Math.abs(apple.angle - hitAngle);
                const normalizedDiff = Math.min(angleDiff, 360 - angleDiff);
                
                if (normalizedDiff < HIT_TOLERANCE + 5) {
                    return {index: i, apple: apple};
                }
            }
            return null;
        }
        
        // æ”¶é›†è˜‹æœ
        function collectApple(appleHit) {
            const apple = appleHit.apple;
            const index = appleHit.index;
            
            apple.element.remove();
            game.applesOnWheel.splice(index, 1);
            
            const coinsEarned = game.isBossLevel ? 20 : 10;
            game.coins += coinsEarned;
            saveCoins(); // ç²å¾—é‡‘å¹£å¾Œç«‹å³ä¿å­˜
            
            showCoinEffect(apple, coinsEarned);
            updateDisplays();
        }
        
        // é¡¯ç¤ºé‡‘å¹£æ•ˆæœ
        function showCoinEffect(apple, amount) {
            const coin = document.createElement('div');
            coin.className = 'coin';
            coin.style.left = apple.element.style.left;
            coin.style.top = apple.element.style.top;
            coin.style.display = 'block';
            
            wheelContainer.appendChild(coin);
            
            const coinText = document.createElement('div');
            coinText.className = 'coin-indicator';
            coinText.textContent = `+${amount}ğŸ’°`;
            coinText.style.left = apple.element.style.left;
            coinText.style.top = apple.element.style.top;
            
            wheelContainer.appendChild(coinText);
            
            coinText.style.animation = 'coinCollect 1s forwards';
            
            setTimeout(() => {
                coin.remove();
                coinText.remove();
            }, 1000);
        }
        
        // é¡¯ç¤ºæ“Šä¸­æ•ˆæœ
        function showHitEffect() {
            hitIndicator.style.animation = 'hitEffect 0.5s';
            setTimeout(() => {
                hitIndicator.style.animation = '';
            }, 500);
        }
        
        // å°‡é£›åˆ€æ·»åŠ åˆ°è¼ªç›¤
        function addKnifeToWheel(angle) {
            const knife = document.createElement('div');
            knife.className = 'knife-on-wheel';
            
            const knifeType = knifeTypes[game.currentKnife];
            knife.style.background = knifeType.color;
            
            if (knifeType.special) {
                knife.classList.add('special-knife');
            }
            
            const radian = (angle * Math.PI) / 180;
            const x = Math.cos(radian) * WHEEL_RADIUS;
            const y = Math.sin(radian) * WHEEL_RADIUS;
            
            const containerCenter = WHEEL_CONTAINER_SIZE / 2;
            knife.style.left = `${containerCenter + x}px`;
            knife.style.top = `${containerCenter + y}px`;
            
            knife.style.animation = 'knifeAppear 0.3s';
            
            wheelContainer.appendChild(knife);
            game.knivesOnWheel.push({
                element: knife, 
                angle: angle,
                x: x,
                y: y
            });
        }
        
        // é—œå¡å®Œæˆ
        function levelComplete() {
            game.gameActive = false;
            
            const baseCoins = game.isBossLevel ? 50 : 10;
            const earnedCoins = baseCoins * game.level;
            const earnedScore = game.isBossLevel ? 500 : 100 * game.level;
            
            game.coins += earnedCoins;
            game.score += earnedScore;
            saveCoins(); // å®Œæˆé—œå¡å¾Œä¿å­˜é‡‘å¹£
            
            // å¦‚æœæ˜¯Bossé—œå¡ï¼Œè§£é–ç‰¹æ®Šé£›åˆ€
            if (game.isBossLevel) {
                const bossLevelNumber = Math.floor(game.level / 5);
                const specialKnives = ['dragon', 'ice', 'shadow'];
                
                if (bossLevelNumber <= specialKnives.length) {
                    const knifeId = specialKnives[bossLevelNumber - 1];
                    if (!knifeTypes[knifeId].owned) {
                        knifeTypes[knifeId].owned = true;
                        game.ownedKnives.push(knifeId);
                        showMessage(`è§£é–ç‰¹æ®Šé£›åˆ€ï¼š${knifeTypes[knifeId].name}ï¼`);
                        initShop();
                    }
                }
            }
            
            document.getElementById('levelCoins').textContent = earnedCoins;
            document.getElementById('levelScore').textContent = earnedScore;
            levelCompleteScreen.style.display = 'block';
            
            updateDisplays();
        }
        
        // ä¸‹ä¸€é—œ - åªåœ¨é€™è£¡å¢åŠ é€Ÿåº¦
        function nextLevel() {
            game.level++;
            game.gameActive = true;
            levelCompleteScreen.style.display = 'none';
            setupLevel(); // é€™è£¡æœƒæ ¹æ“šé—œå¡æ•¸è¨ˆç®—æ–°çš„é€Ÿåº¦
            
            updateDisplays();
            console.log(`é€²å…¥ä¸‹ä¸€é—œ: ${game.level}, é€Ÿåº¦: ${game.rotationSpeed.toFixed(1)}x`);
        }
        
        // éŠæˆ²çµæŸ - é‡‘å¹£ä¸æœƒæ¶ˆå¤±
        function gameOver(reason) {
            game.gameActive = false;
            
            // è¨ˆç®—ç²å¾—é‡‘å¹£ï¼ˆåŸºæ–¼åˆ†æ•¸ï¼‰
            const earnedCoins = Math.floor(game.score / 20);
            game.coins += earnedCoins;
            saveCoins(); // éŠæˆ²çµæŸæ™‚ä¹Ÿä¿å­˜é‡‘å¹£
            
            // é¡¯ç¤ºéŠæˆ²çµæŸç•«é¢
            document.getElementById('gameOverReason').textContent = reason;
            document.getElementById('finalScore').textContent = game.score;
            document.getElementById('finalCoins').textContent = earnedCoins;
            gameOverScreen.style.display = 'block';
            
            updateDisplays();
            console.log(`éŠæˆ²çµæŸï¼Œé‡‘å¹£å·²ä¿å­˜: ${game.coins}`);
        }
        
        // éŠæˆ²ä¸»å¾ªç’°
        function gameLoop() {
            if (game.gameActive) {
                // æ›´æ–°è¼ªç›¤æ—‹è½‰è§’åº¦
                game.wheelRotation += game.rotationSpeed;
                if (game.wheelRotation >= 360) {
                    game.wheelRotation -= 360;
                }
                
                // æ‡‰ç”¨æ—‹è½‰åˆ°è¼ªç›¤
                wheel.style.transform = `translate(-50%, -50%) rotate(${game.wheelRotation}deg)`;
                
                // æ›´æ–°è¼ªç›¤ä¸Šæ‰€æœ‰é£›åˆ€çš„ä½ç½®å’Œè§’åº¦
                game.knivesOnWheel.forEach(knife => {
                    const currentAngle = (knife.angle + game.wheelRotation) % 360;
                    const radian = (currentAngle * Math.PI) / 180;
                    const x = Math.cos(radian) * WHEEL_RADIUS;
                    const y = Math.sin(radian) * WHEEL_RADIUS;
                    
                    const containerCenter = WHEEL_CONTAINER_SIZE / 2;
                    knife.element.style.left = `${containerCenter + x}px`;
                    knife.element.style.top = `${containerCenter + y}px`;
                    knife.element.style.transform = `rotate(${currentAngle}deg)`;
                    
                    knife.x = x;
                    knife.y = y;
                });
                
                // æ›´æ–°è¼ªç›¤ä¸Šæ‰€æœ‰å°–åˆºçš„ä½ç½®å’Œè§’åº¦
                game.spikesOnWheel.forEach(spike => {
                    const currentAngle = (spike.angle + game.wheelRotation) % 360;
                    const radian = (currentAngle * Math.PI) / 180;
                    const x = Math.cos(radian) * WHEEL_RADIUS;
                    const y = Math.sin(radian) * WHEEL_RADIUS;
                    
                    const containerCenter = WHEEL_CONTAINER_SIZE / 2;
                    spike.element.style.left = `${containerCenter + x}px`;
                    spike.element.style.top = `${containerCenter + y}px`;
                    spike.element.style.transform = `rotate(${currentAngle}deg)`;
                    
                    spike.x = x;
                    spike.y = y;
                });
                
                // æ›´æ–°è¼ªç›¤ä¸Šæ‰€æœ‰è˜‹æœçš„ä½ç½®
                game.applesOnWheel.forEach(apple => {
                    const currentAngle = (apple.angle + game.wheelRotation) % 360;
                    const radian = (currentAngle * Math.PI) / 180;
                    const x = Math.cos(radian) * (WHEEL_RADIUS - 20);
                    const y = Math.sin(radian) * (WHEEL_RADIUS - 20);
                    
                    const containerCenter = WHEEL_CONTAINER_SIZE / 2;
                    apple.element.style.left = `${containerCenter + x}px`;
                    apple.element.style.top = `${containerCenter + y}px`;
                    
                    apple.x = x;
                    apple.y = y;
                });
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // äº‹ä»¶ç›£è½å™¨
        throwButton.addEventListener('click', throwKnife);
        nextLevelButton.addEventListener('click', nextLevel);
        restartButton.addEventListener('click', initGame);
        
        // å•†åº—ç›¸é—œäº‹ä»¶
        shopButton.addEventListener('click', () => {
            shopPanel.style.display = 'block';
            initShop();
        });
        
        closeShop.addEventListener('click', () => {
            shopPanel.style.display = 'none';
        });
        
        // éµç›¤æ§åˆ¶
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && game.gameActive) {
                e.preventDefault();
                throwKnife();
                
                throwButton.style.animation = 'pulse 0.2s';
                setTimeout(() => {
                    throwButton.style.animation = '';
                }, 200);
            }
        });
        
        // æ¸…é™¤ä¿å­˜çš„é‡‘å¹£ï¼ˆèª¿è©¦ç”¨ï¼‰
        function clearSavedCoins() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ä¿å­˜çš„é‡‘å¹£å—ï¼Ÿ')) {
                localStorage.removeItem('ninjaKnifeCoins');
                alert('é‡‘å¹£å·²æ¸…é™¤ï¼');
                initGame();
            }
        }
        
        // åˆå§‹åŒ–éŠæˆ²
        initGame();
    </script>
</body>
</html>